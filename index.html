<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <title>Base Auto Battler</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { width: 100%; height: 100%; overflow: hidden; background: #1a1a2e; overscroll-behavior: none; }
    #game-container {
      position: relative;
      width: 100%;
      height: 100%;
      touch-action: none;
      -webkit-user-select: none;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }
    #game-canvas {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
    }
    #ui-overlay {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none;
      font-family: 'Segoe UI', system-ui, sans-serif;
      color: #e0d8c0;
    }
    #ui-overlay > * { pointer-events: auto; }

    /* ── Resource Bar ── */
    #resource-bar {
      position: absolute;
      top: 10px; left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 18px;
      background: rgba(30, 20, 10, 0.85);
      border: 1px solid rgba(200, 160, 60, 0.4);
      border-radius: 8px;
      padding: 10px 20px;
      font-size: 17px;
    }
    .resource-item {
      display: flex;
      align-items: center;
      gap: 6px;
      position: relative;
      cursor: default;
    }
    .resource-item[data-tip]::after {
      content: attr(data-tip);
      position: absolute;
      top: 100%; left: 50%;
      transform: translateX(-50%);
      margin-top: 8px;
      background: rgba(30, 20, 10, 0.95);
      border: 1px solid rgba(200, 160, 60, 0.5);
      border-radius: 5px;
      padding: 6px 11px;
      font-size: 13px;
      color: #f0e6d3;
      white-space: nowrap;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.15s;
      z-index: 20;
    }
    .resource-item[data-tip]:hover::after { opacity: 1; }
    .resource-icon {
      width: 18px; height: 18px;
      border-radius: 4px;
      display: inline-block;
    }
    .res-income {
      font-size: 13px;
      color: #a0c8ff;
      opacity: 0.7;
      margin-left: 3px;
    }
    .res-delta {
      font-size: 13px;
      opacity: 0.7;
    }
    .res-delta.positive { color: #80e060; }
    .res-delta.negative { color: #e06060; }
    .res-delta.zero { color: #a0a0a0; }

    /* ── Base HP Bar ── */
    #base-hp-bar {
      position: absolute;
      top: 56px; left: 50%;
      transform: translateX(-50%);
      width: 360px; height: 8px;
      background: rgba(0, 0, 0, 0.4);
      border-radius: 4px;
      overflow: hidden;
    }
    #base-hp-fill {
      height: 100%;
      background: #c0392b;
      transition: width 0.3s;
      border-radius: 4px;
    }

    /* ── Phase / Wave indicator ── */
    #phase-bar {
      position: absolute;
      top: 10px; right: 16px;
      display: flex;
      gap: 14px;
      align-items: center;
      background: rgba(30, 20, 10, 0.85);
      border: 1px solid rgba(200, 160, 60, 0.4);
      border-radius: 8px;
      padding: 8px 18px;
      font-size: 16px;
    }
    #phase-label {
      text-transform: uppercase;
      letter-spacing: 2px;
      font-weight: bold;
      font-size: 15px;
      color: #c8a03c;
    }

    /* ── Hex Hover Tooltip ── */
    #hex-hover {
      position: absolute;
      pointer-events: none;
      background: rgba(30, 20, 10, 0.9);
      border: 1px solid rgba(200, 160, 60, 0.4);
      border-radius: 5px;
      padding: 4px 8px;
      font-size: 12px;
      white-space: nowrap;
      display: none;
      z-index: 10;
    }
    #hex-hover.visible { display: block; }

    /* ── Hex Selection Panel ── */
    #hex-info {
      position: absolute;
      top: 80px; right: 16px;
      background: rgba(30, 20, 10, 0.9);
      border: 1px solid rgba(200, 160, 60, 0.4);
      border-radius: 8px;
      padding: 14px 18px;
      font-size: 16px;
      width: 260px;
      display: none;
      line-height: 1.5;
    }
    #hex-info.visible { display: block; }
    #hex-info .info-header {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 8px;
      border-bottom: 1px solid rgba(200, 160, 60, 0.3);
      padding-bottom: 6px;
      color: #c8a03c;
    }
    #hex-info .info-row {
      font-size: 15px;
      color: rgba(240, 230, 211, 0.8);
    }
    #hex-info .info-section {
      margin-top: 6px;
      border-top: 1px solid rgba(200, 160, 60, 0.3);
      padding-top: 5px;
    }
    .build-btn {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      background: rgba(200, 160, 60, 0.15);
      border: 1px solid rgba(200, 160, 60, 0.3);
      color: #f0e6d3;
      border-radius: 5px;
      padding: 7px 10px;
      cursor: pointer;
      font-size: 14px;
      margin: 4px 0;
      text-align: left;
      transition: background 0.1s;
    }
    .build-btn:hover { background: rgba(200, 160, 60, 0.35); }
    .build-btn.disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }
    .build-btn.disabled:hover { background: rgba(200, 160, 60, 0.15); }
    .build-btn .build-name { font-weight: bold; }
    .build-btn .build-cost {
      font-size: 12px;
      opacity: 0.7;
    }

    /* ── Debug Panel ── */
    #debug-panel {
      position: absolute;
      top: 8px; left: 0;
      display: flex;
      flex-direction: row;
    }
    #debug-tab {
      background: rgba(30, 20, 10, 0.85);
      border: 1px solid rgba(200, 160, 60, 0.4);
      border-left: none;
      border-radius: 0 6px 6px 0;
      padding: 4px 8px;
      cursor: pointer;
      font-size: 11px;
      color: #c8a03c;
      white-space: nowrap;
    }
    #debug-tab:hover { background: rgba(200, 160, 60, 0.25); }
    #debug-content {
      width: 0; height: 0;
      overflow: hidden;
      background: rgba(30, 20, 10, 0.9);
      border: 1px solid rgba(200, 160, 60, 0.4);
      border-left: none;
      border-radius: 0 6px 6px 0;
      transition: width 0.2s ease, height 0.2s ease;
      white-space: nowrap;
      font-size: 12px;
      line-height: 1.6;
    }
    #debug-panel.debug-open #debug-content {
      width: 240px;
      height: auto;
      padding: 10px 12px;
      overflow-y: auto;
      max-height: 80vh;
    }
    #debug-panel.debug-open #debug-tab { display: none; }
    .debug-section {
      margin-bottom: 8px;
      border-bottom: 1px solid rgba(200, 160, 60, 0.2);
      padding-bottom: 6px;
    }
    .debug-section:last-child { border-bottom: none; }
    .debug-section-title {
      color: #c8a03c;
      font-weight: bold;
      font-size: 11px;
      text-transform: uppercase;
      margin-bottom: 3px;
    }
    .debug-row {
      display: flex;
      justify-content: space-between;
      gap: 8px;
    }
    .debug-val { color: #f0e6d3; }
    .debug-lbl { color: rgba(240, 230, 211, 0.6); }
    #debug-close {
      background: none; border: none;
      color: rgba(240, 230, 211, 0.5);
      cursor: pointer;
      font-size: 14px;
      float: right;
      padding: 0 2px;
      line-height: 1;
    }
    #debug-close:hover { color: #f0e6d3; }
    .debug-btn {
      background: rgba(200, 160, 60, 0.2);
      border: 1px solid rgba(200, 160, 60, 0.3);
      color: #f0e6d3;
      border-radius: 4px;
      padding: 3px 8px;
      cursor: pointer;
      font-size: 11px;
      margin: 2px 2px 2px 0;
    }
    .debug-btn:hover { background: rgba(200, 160, 60, 0.4); }
    .debug-checkbox {
      display: flex;
      align-items: center;
      gap: 6px;
      margin: 3px 0;
    }
    .debug-checkbox input { accent-color: #c8a03c; }

    /* ── Build Bar ── */
    #build-bar {
      position: absolute;
      bottom: 14px; left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 6px;
      background: rgba(30, 20, 10, 0.9);
      border: 1px solid rgba(200, 160, 60, 0.4);
      border-radius: 10px;
      padding: 8px 14px;
    }
    .build-bar-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      background: rgba(200, 160, 60, 0.1);
      border: 2px solid rgba(200, 160, 60, 0.2);
      border-radius: 8px;
      padding: 8px 12px;
      cursor: pointer;
      transition: background 0.1s, border-color 0.15s;
      min-width: 72px;
      position: relative;
    }
    .build-bar-item:hover {
      background: rgba(200, 160, 60, 0.25);
      border-color: rgba(200, 160, 60, 0.5);
    }
    .build-bar-item.active {
      background: rgba(200, 160, 60, 0.3);
      border-color: #c8a03c;
    }
    .build-bar-item.disabled {
      opacity: 0.35;
      cursor: not-allowed;
    }
    .build-bar-item.disabled:hover {
      background: rgba(200, 160, 60, 0.1);
      border-color: rgba(200, 160, 60, 0.2);
    }
    .build-bar-icon {
      width: 32px; height: 32px;
      border-radius: 5px;
    }
    .build-bar-label {
      font-size: 12px;
      color: rgba(240, 230, 211, 0.7);
      white-space: nowrap;
    }
    .build-bar-cost {
      font-size: 11px;
      color: rgba(240, 230, 211, 0.45);
      white-space: nowrap;
    }
    .build-bar-item[data-tip]::after {
      content: attr(data-tip);
      position: absolute;
      bottom: 100%; left: 50%;
      transform: translateX(-50%);
      margin-bottom: 8px;
      background: rgba(30, 20, 10, 0.95);
      border: 1px solid rgba(200, 160, 60, 0.5);
      border-radius: 5px;
      padding: 6px 11px;
      font-size: 13px;
      color: #f0e6d3;
      white-space: nowrap;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.15s;
      z-index: 20;
    }
    .build-bar-item[data-tip]:hover::after { opacity: 1; }

    /* ── Ready Button ── */
    #ready-btn {
      background: rgba(200, 160, 60, 0.25);
      border: 1px solid rgba(200, 160, 60, 0.5);
      color: #f0e6d3;
      border-radius: 5px;
      padding: 6px 16px;
      cursor: pointer;
      font-size: 15px;
      font-weight: bold;
      transition: background 0.15s;
    }
    #ready-btn:hover { background: rgba(200, 160, 60, 0.45); }
    #ready-btn.hidden { display: none; }

    /* ── Roster Label ── */
    #roster-label {
      font-size: 14px;
      color: rgba(240, 230, 211, 0.7);
    }

    /* ── Train Button ── */
    .train-btn {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      background: rgba(139, 60, 40, 0.2);
      border: 1px solid rgba(139, 60, 40, 0.4);
      color: #f0e6d3;
      border-radius: 5px;
      padding: 7px 10px;
      cursor: pointer;
      font-size: 14px;
      margin: 4px 0;
      text-align: left;
      transition: background 0.1s;
    }
    .train-btn:hover { background: rgba(139, 60, 40, 0.45); }
    .train-btn.disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }
    .train-btn.disabled:hover { background: rgba(139, 60, 40, 0.2); }
    .train-btn .build-name { font-weight: bold; }
    .train-btn .build-cost {
      font-size: 10px;
      opacity: 0.7;
    }

    /* ── Battle Results Overlay ── */
    #battle-results {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 100;
      justify-content: center;
      align-items: center;
    }
    #battle-results.visible {
      display: flex;
    }
    #battle-results-modal {
      background: rgba(30, 20, 10, 0.95);
      border: 2px solid rgba(200, 160, 60, 0.5);
      border-radius: 12px;
      padding: 36px 48px;
      min-width: 360px;
      max-width: 520px;
      text-align: center;
    }
    #br-title {
      font-size: 32px;
      font-weight: bold;
      margin-bottom: 16px;
    }
    #br-body {
      font-size: 18px;
      line-height: 1.8;
      margin-bottom: 24px;
      color: rgba(240, 230, 211, 0.85);
    }
    #br-continue {
      background: rgba(200, 160, 60, 0.3);
      border: 1px solid rgba(200, 160, 60, 0.5);
      color: #f0e6d3;
      border-radius: 6px;
      padding: 12px 36px;
      cursor: pointer;
      font-size: 18px;
      font-weight: bold;
      transition: background 0.15s;
    }
    #br-continue:hover { background: rgba(200, 160, 60, 0.5); }

    /* ── Roster Panel ── */
    #roster-toggle {
      background: rgba(200, 160, 60, 0.25);
      border: 1px solid rgba(200, 160, 60, 0.5);
      color: #f0e6d3;
      border-radius: 5px;
      padding: 6px 14px;
      cursor: pointer;
      font-size: 15px;
      font-weight: bold;
      transition: background 0.15s;
    }
    #roster-toggle:hover { background: rgba(200, 160, 60, 0.45); }
    #roster-panel {
      position: absolute;
      top: 60px; left: 8px;
      background: rgba(30, 20, 10, 0.92);
      border: 1px solid rgba(200, 160, 60, 0.4);
      border-radius: 6px;
      padding: 10px 12px;
      font-size: 12px;
      width: 250px;
      max-height: calc(100vh - 140px);
      overflow-y: auto;
      display: none;
      z-index: 15;
    }
    #roster-panel.visible { display: block; }
    .roster-header {
      font-size: 14px; font-weight: bold; color: #c8a03c;
      margin-bottom: 8px;
      display: flex; justify-content: space-between; align-items: center;
    }
    .roster-section { margin-bottom: 6px; border-top: 1px solid rgba(200, 160, 60, 0.2); padding-top: 4px; }
    .roster-section-title { font-size: 10px; text-transform: uppercase; color: #c8a03c; margin-bottom: 3px; letter-spacing: 1px; }
    .roster-unit {
      display: flex; align-items: center; justify-content: space-between;
      background: rgba(200, 160, 60, 0.08); border: 1px solid rgba(200, 160, 60, 0.15);
      border-radius: 4px; padding: 3px 6px; margin: 2px 0; cursor: pointer;
      transition: background 0.1s; gap: 4px;
    }
    .roster-unit:hover { background: rgba(200, 160, 60, 0.2); }
    .roster-unit-info { flex: 1; min-width: 0; }
    .roster-unit-name { font-weight: bold; font-size: 11px; }
    .roster-unit-stats { font-size: 9px; color: rgba(240,230,211,0.5); }
    .roster-unit-lives { color: #e06060; font-size: 10px; }
    .roster-zone-btns { display: flex; gap: 2px; flex-shrink: 0; }
    .zone-btn {
      background: rgba(200, 160, 60, 0.15); border: 1px solid rgba(200, 160, 60, 0.25);
      color: #e0d8c0; border-radius: 3px; padding: 2px 5px; cursor: pointer; font-size: 9px;
      transition: background 0.1s;
    }
    .zone-btn:hover { background: rgba(200, 160, 60, 0.35); }
    .roster-empty { color: rgba(240,230,211,0.3); font-style: italic; font-size: 11px; padding: 2px 0; }

    /* ── Unit Detail Panel ── */
    #unit-detail { display: none; margin-top: 6px; border-top: 1px solid rgba(200,160,60,0.3); padding-top: 6px; }
    #unit-detail.visible { display: block; }
    .unit-detail-header { font-size: 13px; font-weight: bold; color: #c8a03c; margin-bottom: 4px; }
    .unit-detail-stats { font-size: 11px; line-height: 1.6; }
    .unit-equip-slot {
      display: flex; align-items: center; justify-content: space-between;
      background: rgba(100,140,180,0.1); border: 1px solid rgba(100,140,180,0.2);
      border-radius: 3px; padding: 3px 6px; margin: 2px 0; font-size: 11px;
    }
    .equip-action-btn {
      background: rgba(100,140,180,0.2); border: 1px solid rgba(100,140,180,0.3);
      color: #b0d0f0; border-radius: 3px; padding: 1px 6px; cursor: pointer; font-size: 10px;
    }
    .equip-action-btn:hover { background: rgba(100,140,180,0.4); }

    /* ── Tech Shop ── */
    #tech-shop-btn {
      background: rgba(200, 160, 60, 0.25); border: 1px solid rgba(200, 160, 60, 0.5);
      color: #f0e6d3; border-radius: 5px; padding: 6px 14px; cursor: pointer;
      font-size: 15px; font-weight: bold; transition: background 0.15s;
    }
    #tech-shop-btn:hover { background: rgba(200, 160, 60, 0.45); }
    #tech-shop {
      display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.75); z-index: 100; justify-content: center; align-items: center;
    }
    #tech-shop.visible { display: flex; }
    #tech-shop-modal {
      background: rgba(30,20,10,0.95); border: 2px solid rgba(200,160,60,0.5);
      border-radius: 12px; padding: 32px 36px; min-width: 400px; max-width: 620px; width: 90vw;
    }
    .tech-shop-title { font-size: 28px; font-weight: bold; color: #c8a03c; text-align: center; margin-bottom: 6px; }
    .tech-shop-bp { text-align: center; font-size: 17px; color: #e8c840; margin-bottom: 16px; }
    .tech-card {
      background: rgba(200,160,60,0.1); border: 1px solid rgba(200,160,60,0.3);
      border-radius: 8px; padding: 14px 16px; margin: 8px 0; cursor: pointer;
      transition: background 0.15s, border-color 0.15s;
      display: flex; justify-content: space-between; align-items: center;
    }
    .tech-card:hover { background: rgba(200,160,60,0.25); border-color: rgba(200,160,60,0.6); }
    .tech-card.disabled { opacity: 0.4; cursor: not-allowed; }
    .tech-card.disabled:hover { background: rgba(200,160,60,0.1); border-color: rgba(200,160,60,0.3); }
    .tech-card-info { flex: 1; }
    .tech-card-name { font-weight: bold; font-size: 17px; color: #f0e6d3; }
    .tech-card-desc { font-size: 14px; color: rgba(240,230,211,0.7); margin-top: 3px; }
    .tech-card-category { font-size: 11px; text-transform: uppercase; letter-spacing: 1px; padding: 2px 7px; border-radius: 3px; margin-top: 4px; display: inline-block; }
    .tech-cat-combat { background: rgba(200,60,60,0.25); color: #e08080; }
    .tech-cat-economy { background: rgba(60,180,60,0.25); color: #80c080; }
    .tech-cat-utility { background: rgba(80,120,200,0.25); color: #80a0e0; }
    .tech-card-cost { font-weight: bold; font-size: 18px; color: #e8c840; margin-left: 16px; white-space: nowrap; }
    .tech-shop-close {
      display: block; margin: 16px auto 0;
      background: rgba(200,160,60,0.2); border: 1px solid rgba(200,160,60,0.4);
      color: #f0e6d3; border-radius: 6px; padding: 10px 28px; cursor: pointer; font-size: 16px;
    }
    .tech-shop-close:hover { background: rgba(200,160,60,0.4); }

    /* ── Card Selection ── */
    #card-selection {
      display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.75); z-index: 100; justify-content: center; align-items: center;
    }
    #card-selection.visible { display: flex; }
    #card-selection-modal {
      background: rgba(30,20,10,0.95); border: 2px solid rgba(200,160,60,0.5);
      border-radius: 12px; padding: 32px 36px; min-width: 400px; max-width: 750px; width: 90vw;
      text-align: center;
    }
    .card-selection-title { font-size: 28px; font-weight: bold; color: #c8a03c; margin-bottom: 20px; }
    .card-choices { display: flex; gap: 16px; justify-content: center; flex-wrap: wrap; }
    .reward-card {
      background: rgba(30,25,15,0.9); border: 2px solid rgba(200,160,60,0.3);
      border-radius: 10px; padding: 20px 18px; width: 200px; cursor: pointer;
      transition: transform 0.15s, border-color 0.15s, box-shadow 0.15s; text-align: center;
    }
    .reward-card:hover { transform: translateY(-4px); border-color: #c8a03c; box-shadow: 0 4px 16px rgba(200,160,60,0.3); }
    .reward-card-name { font-weight: bold; font-size: 17px; margin-bottom: 8px; }
    .reward-card-desc { font-size: 14px; color: rgba(240,230,211,0.7); margin-bottom: 8px; line-height: 1.5; }
    .reward-card-type { font-size: 11px; text-transform: uppercase; letter-spacing: 1px; color: rgba(240,230,211,0.4); }
    .rarity-common { border-color: rgba(180,180,180,0.4); }
    .rarity-common .reward-card-name { color: #c0c0c0; }
    .rarity-rare { border-color: rgba(80,130,220,0.5); }
    .rarity-rare .reward-card-name { color: #6090e0; }
    .rarity-epic { border-color: rgba(160,60,200,0.5); }
    .rarity-epic .reward-card-name { color: #b060e0; }
    .rarity-legendary { border-color: rgba(220,180,40,0.6); }
    .rarity-legendary .reward-card-name { color: #e8c840; }

    /* ── Starter Kit Selection ── */
    #starter-select {
      display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.85); z-index: 200; justify-content: center; align-items: center;
    }
    #starter-select.visible { display: flex; }
    #starter-select-modal {
      background: rgba(30,20,10,0.95); border: 2px solid rgba(200,160,60,0.5);
      border-radius: 12px; padding: 36px 40px; min-width: 400px; max-width: 850px; width: 90vw;
      text-align: center;
    }
    .starter-title { font-size: 30px; font-weight: bold; color: #c8a03c; margin-bottom: 24px; }
    .starter-choices { display: flex; gap: 16px; justify-content: center; flex-wrap: wrap; }
    .starter-card {
      background: rgba(30,25,15,0.9); border: 2px solid rgba(200,160,60,0.3);
      border-radius: 10px; padding: 22px 18px; width: 190px; cursor: pointer;
      transition: transform 0.15s, border-color 0.15s, box-shadow 0.15s; text-align: center;
    }
    .starter-card:hover { transform: translateY(-4px); border-color: #c8a03c; box-shadow: 0 4px 16px rgba(200,160,60,0.3); }
    .starter-card-name { font-weight: bold; font-size: 18px; color: #c8a03c; margin-bottom: 10px; }
    .starter-card-desc { font-size: 14px; color: rgba(240,230,211,0.7); margin-bottom: 10px; line-height: 1.5; }
    .starter-card-details { font-size: 13px; color: rgba(240,230,211,0.5); line-height: 1.6; }
    .starter-card-details span { display: block; }

    /* ── Blacksmith Crafting ── */
    .craft-btn {
      display: flex; align-items: center; justify-content: space-between; width: 100%;
      background: rgba(100,140,180,0.15); border: 1px solid rgba(100,140,180,0.3);
      color: #f0e6d3; border-radius: 4px; padding: 5px 8px; cursor: pointer;
      font-size: 12px; margin: 3px 0; text-align: left; transition: background 0.1s;
    }
    .craft-btn:hover { background: rgba(100,140,180,0.35); }
    .craft-btn.disabled { opacity: 0.4; cursor: not-allowed; }
    .craft-btn.disabled:hover { background: rgba(100,140,180,0.15); }
    .craft-btn .build-name { font-weight: bold; }
    .craft-btn .build-cost { font-size: 10px; opacity: 0.7; }
    .upgrade-bs-btn, .upgrade-bld-btn {
      background: rgba(200,120,40,0.2); border: 1px solid rgba(200,120,40,0.4);
      color: #f0e6d3; border-radius: 4px; padding: 5px 8px; cursor: pointer;
      font-size: 12px; margin: 5px 0; width: 100%; text-align: center; font-weight: bold;
      transition: background 0.1s;
    }
    .upgrade-bs-btn:hover, .upgrade-bld-btn:hover { background: rgba(200,120,40,0.4); }
    .upgrade-bs-btn.disabled, .upgrade-bld-btn.disabled { opacity: 0.4; cursor: not-allowed; }

    /* ── Relics Bar ── */
    #relics-bar {
      position: absolute; top: 70px; left: 50%; transform: translateX(-50%);
      display: flex; gap: 6px; font-size: 13px;
    }
    .relic-badge {
      background: rgba(160,60,200,0.2); border: 1px solid rgba(160,60,200,0.4);
      border-radius: 5px; padding: 3px 8px; color: #c090e0; cursor: default;
    }

    /* ── Battle Controls ── */
    #battle-controls {
      display: none;
      position: absolute;
      bottom: 12px; left: 50%;
      transform: translateX(-50%);
      background: rgba(30, 20, 10, 0.9);
      border: 1px solid rgba(200, 160, 60, 0.4);
      border-radius: 8px;
      padding: 6px 12px;
      gap: 6px;
      align-items: center;
      z-index: 50;
    }
    #battle-controls.visible { display: flex; }
    .speed-btn {
      background: rgba(200, 160, 60, 0.15);
      border: 1px solid rgba(200, 160, 60, 0.3);
      color: #e0d8c0;
      border-radius: 4px;
      padding: 5px 12px;
      cursor: pointer;
      font-size: 12px;
      font-weight: bold;
      transition: background 0.1s, border-color 0.15s;
    }
    .speed-btn:hover { background: rgba(200, 160, 60, 0.3); }
    .speed-btn.active {
      background: rgba(200, 160, 60, 0.4);
      border-color: #c8a03c;
      color: #f0e6d3;
    }
    #battle-tick-counter {
      font-size: 11px;
      color: rgba(240, 230, 211, 0.6);
      min-width: 60px;
      text-align: center;
    }

    /* ── Mobile: <= 768px ── */
    @media (max-width: 768px) {
      #resource-bar {
        left: 8px;
        right: 8px;
        transform: none;
        gap: 8px;
        padding: 5px 10px;
        font-size: 12px;
        flex-wrap: wrap;
        justify-content: center;
        top: calc(8px + env(safe-area-inset-top, 0px));
      }
      #base-hp-bar {
        left: 8px;
        right: 8px;
        width: auto;
        transform: none;
        top: calc(42px + env(safe-area-inset-top, 0px));
      }
      #phase-bar {
        top: calc(56px + env(safe-area-inset-top, 0px));
        right: 8px;
        left: 8px;
        transform: none;
        font-size: 11px;
        padding: 5px 10px;
        gap: 6px;
        justify-content: center;
      }
      #phase-label { font-size: 10px; letter-spacing: 1px; }
      #ready-btn { padding: 4px 10px; font-size: 11px; min-height: 32px; }
      #hex-info {
        position: absolute;
        top: auto;
        bottom: 80px;
        left: 0;
        right: 0;
        width: 100%;
        max-width: 100%;
        max-height: 40vh;
        overflow-y: auto;
        border-radius: 12px 12px 0 0;
        padding: 14px 16px;
      }
      .build-btn, .train-btn {
        padding: 10px 12px;
        min-height: 44px;
        font-size: 13px;
      }
      #build-bar {
        left: 8px;
        right: 8px;
        transform: none;
        overflow-x: auto;
        bottom: calc(12px + env(safe-area-inset-bottom, 0px));
        -webkit-overflow-scrolling: touch;
      }
      .build-bar-item {
        min-width: 60px;
        min-height: 44px;
        flex-shrink: 0;
      }
      .build-bar-icon { width: 28px; height: 28px; }
      #debug-panel { display: none; }
      #hex-hover { display: none !important; }
      [data-tip]::after { display: none !important; }
      #roster-panel {
        top: auto; bottom: 80px; left: 0; right: 0; width: 100%;
        max-height: 50vh; border-radius: 12px 12px 0 0;
      }
      #roster-toggle, #tech-shop-btn { padding: 4px 8px; font-size: 10px; min-height: 32px; }
      .reward-card { width: 160px; padding: 14px 12px; }
      .reward-card-name { font-size: 14px; }
      .reward-card-desc { font-size: 12px; }
      .starter-card { width: 160px; padding: 16px 12px; }
      .starter-card-name { font-size: 15px; }
      .starter-card-desc { font-size: 12px; }
      .starter-title { font-size: 22px; }
      .card-selection-title { font-size: 22px; }
      #br-title { font-size: 26px; }
      #br-body { font-size: 15px; }
      #br-continue { font-size: 15px; padding: 10px 28px; }
      .tech-shop-title { font-size: 22px; }
      .tech-card-name { font-size: 14px; }
      .tech-card-desc { font-size: 12px; }
      #battle-controls {
        bottom: calc(12px + env(safe-area-inset-bottom, 0px));
        padding: 5px 8px;
      }
      .speed-btn { padding: 8px 14px; min-height: 36px; font-size: 13px; }
    }

    /* ── Small phones: <= 480px ── */
    @media (max-width: 480px) {
      #resource-bar {
        gap: 5px;
        padding: 4px 8px;
        font-size: 11px;
      }
      .resource-icon { width: 12px; height: 12px; }
      #base-hp-bar {
        top: calc(36px + env(safe-area-inset-top, 0px));
      }
      #phase-bar {
        top: calc(48px + env(safe-area-inset-top, 0px));
        font-size: 10px;
        padding: 4px 8px;
        gap: 5px;
      }
      #phase-label { font-size: 9px; letter-spacing: 1px; }
      #wave-label { font-size: 10px; }
      #ready-btn { padding: 3px 8px; font-size: 10px; min-height: 28px; }
      .build-bar-item {
        min-width: 52px;
        padding: 4px 6px;
      }
      .build-bar-icon { width: 24px; height: 24px; }
      .build-bar-label { font-size: 8px; }
      .build-bar-cost { font-size: 7px; }
    }

    /* ── Landscape with short viewport ── */
    @media (max-height: 500px) and (orientation: landscape) {
      #resource-bar { padding: 3px 10px; font-size: 11px; }
      #base-hp-bar { height: 4px; top: 34px; }
      #hex-info {
        top: 60px;
        bottom: auto;
        left: auto;
        right: 8px;
        width: 260px;
        max-height: calc(100vh - 130px);
        border-radius: 6px;
      }
      #build-bar { padding: 4px 8px; }
      .build-bar-item { padding: 4px 6px; min-height: 38px; }
    }
  </style>
</head>
<body>
  <div id="game-container">
    <div id="game-canvas"></div>
    <div id="ui-overlay">

      <!-- Resource Bar -->
      <div id="resource-bar">
        <div class="resource-item" data-tip="Used for buildings, basic units, and training.">
          <span class="resource-icon" style="background:#c49a3c;"></span>
          <span>Wood: <span id="res-wood">0</span></span>
          <span class="res-income" id="res-income-wood"></span>
          <span class="res-delta" id="res-delta-wood"></span>
        </div>
        <div class="resource-item" data-tip="Used for fortifications and advanced buildings.">
          <span class="resource-icon" style="background:#b0b0b0;"></span>
          <span>Stone: <span id="res-stone">0</span></span>
          <span class="res-income" id="res-income-stone"></span>
          <span class="res-delta" id="res-delta-stone"></span>
        </div>
        <div class="resource-item" data-tip="Used for equipment crafting and elite units.">
          <span class="resource-icon" style="background:#7a8b9e;"></span>
          <span>Iron: <span id="res-iron">0</span></span>
          <span class="res-income" id="res-income-iron"></span>
          <span class="res-delta" id="res-delta-iron"></span>
        </div>
        <div class="resource-item" data-tip="Battle Points. Earned from waves, spent on tech upgrades.">
          <span class="resource-icon" style="background:#e8c840;"></span>
          <span>BP: <span id="res-bp">0</span></span>
        </div>
      </div>

      <!-- Base HP Bar -->
      <div id="base-hp-bar">
        <div id="base-hp-fill" style="width: 100%;"></div>
      </div>

      <!-- Phase / Wave -->
      <div id="phase-bar">
        <span id="phase-label">Build</span>
        <span id="wave-label">Wave 1</span>
        <button id="roster-toggle">Roster</button>
        <button id="tech-shop-btn">Tech</button>
        <button id="ready-btn">Start Wave</button>
        <span id="roster-label"></span>
      </div>

      <!-- Relics Bar -->
      <div id="relics-bar"></div>

      <!-- Roster Panel -->
      <div id="roster-panel">
        <div class="roster-header">
          <span>Army Roster</span>
          <span id="roster-close" style="cursor:pointer;font-size:16px;color:rgba(240,230,211,0.5);">&times;</span>
        </div>
        <div id="roster-content"></div>
        <div id="unit-detail"></div>
      </div>

      <!-- Hex Hover Tooltip -->
      <div id="hex-hover"></div>

      <!-- Hex Selection Detail Panel -->
      <div id="hex-info">
        <div id="hex-info-content"></div>
      </div>

      <!-- Build Bar -->
      <div id="build-bar"></div>

      <!-- Battle Results Overlay -->
      <div id="battle-results">
        <div id="battle-results-modal">
          <div id="br-title"></div>
          <div id="br-body"></div>
          <button id="br-continue">Continue</button>
        </div>
      </div>

      <!-- Tech Shop Modal -->
      <div id="tech-shop">
        <div id="tech-shop-modal">
          <div class="tech-shop-title">Tech Shop</div>
          <div class="tech-shop-bp">BP: <span id="ts-bp">0</span></div>
          <div id="tech-shop-items"></div>
          <button class="tech-shop-close" id="tech-shop-close">Close</button>
        </div>
      </div>

      <!-- Card Selection Modal -->
      <div id="card-selection">
        <div id="card-selection-modal">
          <div class="card-selection-title">Choose a Reward</div>
          <div class="card-choices" id="card-choices"></div>
        </div>
      </div>

      <!-- Battle Controls -->
      <div id="battle-controls">
        <button class="speed-btn" id="speed-1x">1x</button>
        <button class="speed-btn" id="speed-2x">2x</button>
        <button class="speed-btn" id="speed-4x">4x</button>
        <button class="speed-btn" id="speed-skip">Skip</button>
        <span id="battle-tick-counter"></span>
      </div>

      <!-- Starter Kit Selection -->
      <div id="starter-select">
        <div id="starter-select-modal">
          <div class="starter-title">Choose Your Starter Kit</div>
          <div class="starter-choices" id="starter-choices"></div>
        </div>
      </div>

      <!-- Debug Panel -->
      <div id="debug-panel">
        <div id="debug-tab">Debug</div>
        <div id="debug-content">
          <button id="debug-close">&times;</button>
          <div class="debug-section">
            <div class="debug-section-title">Game</div>
            <div class="debug-row"><span class="debug-lbl">Phase</span><span class="debug-val" id="dbg-phase">build</span></div>
            <div class="debug-row"><span class="debug-lbl">Wave</span><span class="debug-val" id="dbg-wave">1</span></div>
            <div class="debug-row"><span class="debug-lbl">Base HP</span><span class="debug-val" id="dbg-basehp">100/100</span></div>
            <div class="debug-row"><span class="debug-lbl">Units</span><span class="debug-val" id="dbg-units">0</span></div>
            <div class="debug-row"><span class="debug-lbl">Buildings</span><span class="debug-val" id="dbg-buildings">0</span></div>
            <div class="debug-row"><span class="debug-lbl">FPS</span><span class="debug-val" id="dbg-fps">0</span></div>
          </div>
          <div class="debug-section">
            <div class="debug-section-title">Actions</div>
            <div>
              <button class="debug-btn" id="dbg-add-resources">+Resources</button>
              <button class="debug-btn" id="dbg-add-unit">+Swordsman</button>
            </div>
            <div>
              <button class="debug-btn" id="dbg-add-bp">+10 BP</button>
              <button class="debug-btn" id="dbg-heal-base">Heal Base</button>
            </div>
          </div>
          <div class="debug-section">
            <div class="debug-section-title">Data</div>
            <div>
              <button class="debug-btn" id="dbg-dump-state">Dump State</button>
              <button class="debug-btn" id="dbg-new-seed">New Seed</button>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
  <script type="module" src="/src/main.ts"></script>
</body>
</html>
