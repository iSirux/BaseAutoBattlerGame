import type { TechNode } from '@/core/types';

export const TECH_TREE: Record<string, TechNode> = {
  // ── Wood Branch ──
  sawmill_blueprint: {
    id: 'sawmill_blueprint',
    name: 'Sawmill Blueprint',
    description: 'Unlocks the Sawmill building.',
    branch: 'wood',
    cost: 5,
    prereqIds: [],
    effect: { type: 'special', id: 'sawmill_blueprint' },
  },
  lumber_economy: {
    id: 'lumber_economy',
    name: 'Lumber Economy',
    description: 'Wood production +30%, sawmill output +50%.',
    branch: 'wood',
    cost: 8,
    prereqIds: ['sawmill_blueprint'],
    effect: { type: 'gather_rate', multiplier: 1.3 },
  },
  master_carpentry: {
    id: 'master_carpentry',
    name: 'Master Carpentry',
    description: 'Planks used for tier 2+ building upgrades.',
    branch: 'wood',
    cost: 12,
    prereqIds: ['lumber_economy'],
    effect: { type: 'special', id: 'master_carpentry' },
  },

  // ── Stone Branch ──
  masonry: {
    id: 'masonry',
    name: 'Masonry',
    description: 'Quarries can reach level 2, producing cut stone.',
    branch: 'stone',
    cost: 5,
    prereqIds: [],
    effect: { type: 'special', id: 'masonry' },
  },
  master_construction: {
    id: 'master_construction',
    name: 'Master Construction',
    description: 'All buildings can upgrade to level 3.',
    branch: 'stone',
    cost: 14,
    prereqIds: ['masonry'],
    effect: { type: 'building_upgrade_unlock', value: 3 },
  },

  // ── Iron Branch ──
  metallurgy: {
    id: 'metallurgy',
    name: 'Metallurgy',
    description: 'Unlocks the Smelter building.',
    branch: 'iron',
    cost: 5,
    prereqIds: [],
    effect: { type: 'special', id: 'metallurgy' },
  },
  efficient_smelting: {
    id: 'efficient_smelting',
    name: 'Efficient Smelting',
    description: 'Smelter fuel cost halved, mines produce +1 ore.',
    branch: 'iron',
    cost: 8,
    prereqIds: ['metallurgy'],
    effect: { type: 'special', id: 'efficient_smelting' },
  },
  advanced_forging: {
    id: 'advanced_forging',
    name: 'Advanced Forging',
    description: 'Unlocks Steel tier equipment, smelter output +50%.',
    branch: 'iron',
    cost: 12,
    prereqIds: ['efficient_smelting'],
    effect: { type: 'special', id: 'advanced_forging' },
  },
  master_forging: {
    id: 'master_forging',
    name: 'Master Forging',
    description: 'Unlocks Mithril tier equipment.',
    branch: 'iron',
    cost: 16,
    prereqIds: ['advanced_forging'],
    effect: { type: 'special', id: 'master_forging' },
  },

  // ── Tactical Branch ──
  building_upgrades: {
    id: 'building_upgrades',
    name: 'Building Upgrades',
    description: 'All buildings can upgrade to level 2. Military buildings unlock veteran units.',
    branch: 'tactical',
    cost: 3,
    prereqIds: [],
    effect: { type: 'building_upgrade_unlock', value: 2 },
  },
  deployment_1: {
    id: 'deployment_1',
    name: 'Deployment Training I',
    description: '+1 deployment slot.',
    branch: 'tactical',
    cost: 8,
    prereqIds: [],
    effect: { type: 'deployment_slot', value: 1 },
  },
  deployment_2: {
    id: 'deployment_2',
    name: 'Deployment Training II',
    description: '+1 deployment slot.',
    branch: 'tactical',
    cost: 12,
    prereqIds: ['deployment_1'],
    effect: { type: 'deployment_slot', value: 1 },
  },
  deployment_3: {
    id: 'deployment_3',
    name: 'Deployment Training III',
    description: '+1 deployment slot.',
    branch: 'tactical',
    cost: 16,
    prereqIds: ['deployment_2'],
    effect: { type: 'deployment_slot', value: 1 },
  },
  deployment_4: {
    id: 'deployment_4',
    name: 'Deployment Training IV',
    description: '+1 deployment slot.',
    branch: 'tactical',
    cost: 20,
    prereqIds: ['deployment_3'],
    effect: { type: 'deployment_slot', value: 1 },
  },
  reinforcement_1: {
    id: 'reinforcement_1',
    name: 'Reserve Forces I',
    description: '+1 reinforcement slot.',
    branch: 'tactical',
    cost: 6,
    prereqIds: [],
    effect: { type: 'reinforcement_slot', value: 1 },
  },
  reinforcement_2: {
    id: 'reinforcement_2',
    name: 'Reserve Forces II',
    description: '+1 reinforcement slot.',
    branch: 'tactical',
    cost: 10,
    prereqIds: ['reinforcement_1'],
    effect: { type: 'reinforcement_slot', value: 1 },
  },
  reinforcement_3: {
    id: 'reinforcement_3',
    name: 'Reserve Forces III',
    description: '+1 reinforcement slot.',
    branch: 'tactical',
    cost: 15,
    prereqIds: ['reinforcement_2'],
    effect: { type: 'reinforcement_slot', value: 1 },
  },
  fortune_favor: {
    id: 'fortune_favor',
    name: "Fortune's Favor",
    description: 'Card rarity boost.',
    branch: 'tactical',
    cost: 8,
    prereqIds: [],
    effect: { type: 'card_rarity_boost', value: 1 },
  },
  extra_scout: {
    id: 'extra_scout',
    name: 'Extra Scout',
    description: '+1 card choice.',
    branch: 'tactical',
    cost: 6,
    prereqIds: [],
    effect: { type: 'extra_card_choice', value: 1 },
  },
};

/** Backward-compatible flat array of all tech nodes */
export const TECH_UPGRADES = Object.values(TECH_TREE);
